
> discogs-mcp@0.0.0 test
> vitest


 DEV  v3.0.9 /Users/rian/Documents/GitHub/discogs-mcp

[vpw:info] Starting isolated runtimes for vitest.config.mts...
stdout | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should successfully get a request token
Getting OAuth header for request token...

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should successfully get a request token
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Foauth%2Frequest_token&oauth_callback%3Dhttp%253A%252F%252Flocalhost%253A3000%252Fcallback%26oauth_consumer_key%3Dtest-consumer-key%26oauth_nonce%3DPjrtaBMys6e8TniH7ULmExSd55sQEf49%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810472%26oauth_version%3D1.0
OAuth signing key: test-consumer-secret&
OAuth signature: Frf8BZZJ3YVrQNzHBxeR0S4nR5o=

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should successfully get a request token
Authorization header: OAuth oauth_consumer_key="test-consumer-key", oauth_nonce="PjrtaBMys6e8TniH7ULmExSd55sQEf49", oauth_signature_method="HMAC-SHA1", oauth_timestamp="1765810472", oauth_version="1.0", oauth_callback="http%3A%2F%2Flocalhost%3A3000%2Fcallback", oauth_signature="Frf8BZZJ3YVrQNzHBxeR0S4nR5o%3D"
Making request to: https://api.discogs.com/oauth/request_token

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should successfully get a request token
Discogs response: oauth_token=test-token&oauth_token_secret=test-secret&oauth_callback_confirmed=true

stdout | test/utils/retry.test.ts > Retry Utility > withRetry > should retry on failure and eventually succeed
Retry attempt 1/3 after 100.57954462232907ms delay

stdout | test/utils/retry.test.ts > Retry Utility > withRetry > should retry on failure and eventually succeed
Retry attempt 2/3 after 208.1043808656568ms delay

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should handle API errors
Getting OAuth header for request token...

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should handle API errors
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Foauth%2Frequest_token&oauth_callback%3Dhttp%253A%252F%252Flocalhost%253A3000%252Fcallback%26oauth_consumer_key%3Dtest-consumer-key%26oauth_nonce%3DdYKXy9UtTQTRDUPh985bYn80rdCzLIa5%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_version%3D1.0
OAuth signing key: test-consumer-secret&
OAuth signature: ERaQjiwG56374FLb114gloxP+Mc=

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should handle API errors
Authorization header: OAuth oauth_consumer_key="test-consumer-key", oauth_nonce="dYKXy9UtTQTRDUPh985bYn80rdCzLIa5", oauth_signature_method="HMAC-SHA1", oauth_timestamp="1765810473", oauth_version="1.0", oauth_callback="http%3A%2F%2Flocalhost%3A3000%2Fcallback", oauth_signature="ERaQjiwG56374FLb114gloxP%2BMc%3D"
Making request to: https://api.discogs.com/oauth/request_token

stderr | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should handle API errors
Discogs API error: ResponseError: HTTP 401: Unauthorized
    at withRetry (/Users/rian/Documents/GitHub/discogs-mcp/src/utils/retry.ts:178:11)
    at withRetry (/Users/rian/Documents/GitHub/discogs-mcp/src/utils/retry.ts:108:17)
    at fetchWithRetry (/Users/rian/Documents/GitHub/discogs-mcp/src/utils/retry.ts:171:17)
    at DiscogsAuth.getRequestToken (/Users/rian/Documents/GitHub/discogs-mcp/src/auth/discogs.ts:179:21)
    at /Users/rian/Documents/GitHub/discogs-mcp/test/auth/discogs.spec.ts:61:4
    at Users/rian/Documents/GitHub/discogs-mcp/node_modules/@vitest/runner/dist/index.js:573:22 {
  response: {
    ok: false,
    status: 401,
    statusText: 'Unauthorized',
    text: [Function: text]
  }
}

stdout | test/utils/retry.test.ts > Retry Utility > withRetry > should fail after max retries
Retry attempt 1/2 after 101.71690706017343ms delay

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should handle malformed responses
Getting OAuth header for request token...

stdout | test/utils/retry.test.ts > Retry Utility > withRetry > should fail after max retries
Retry attempt 2/2 after 218.4359963020171ms delay

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should handle malformed responses
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Foauth%2Frequest_token&oauth_callback%3Dhttp%253A%252F%252Flocalhost%253A3000%252Fcallback%26oauth_consumer_key%3Dtest-consumer-key%26oauth_nonce%3DHv4DFP2aRVjeCHMFRgyVomIax2JZEW6z%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_version%3D1.0
OAuth signing key: test-consumer-secret&
OAuth signature: LcZCe8WURCcAWYn1dlKlEzhqGfc=

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should handle malformed responses
Authorization header: OAuth oauth_consumer_key="test-consumer-key", oauth_nonce="Hv4DFP2aRVjeCHMFRgyVomIax2JZEW6z", oauth_signature_method="HMAC-SHA1", oauth_timestamp="1765810473", oauth_version="1.0", oauth_callback="http%3A%2F%2Flocalhost%3A3000%2Fcallback", oauth_signature="LcZCe8WURCcAWYn1dlKlEzhqGfc%3D"
Making request to: https://api.discogs.com/oauth/request_token

stderr | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should handle malformed responses
Discogs API error: Error: Invalid response from Discogs: missing oauth_token or oauth_token_secret
    at DiscogsAuth.getRequestToken (/Users/rian/Documents/GitHub/discogs-mcp/src/auth/discogs.ts:201:11)
    at /Users/rian/Documents/GitHub/discogs-mcp/test/auth/discogs.spec.ts:74:4
    at Users/rian/Documents/GitHub/discogs-mcp/node_modules/@vitest/runner/dist/index.js:573:22

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getRequestToken > should handle malformed responses
Discogs response: invalid_response

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should return all items when no query is provided
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fper_page%3D50&oauth_consumer_key%3Dtest-key%26oauth_nonce%3Dre1NAKTiFqSKyKN63P22gz7cWbDp8PDX%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: s//bo5i+/dJQAF3frf3YNpvmflk=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should filter by artist name when query is provided
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3D3yNaV6BosqUqxO7QQV7hqPUIqvQEHZuN%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: z7OrLRgQq51JxTHQkBDYQwgGnO4=

stdout | test/utils/retry.test.ts > Retry Utility > fetchWithRetry > should retry on 429 status
Retry attempt 1/3 after 2110.4114189854813ms delay

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getAccessToken > should successfully exchange for access token
OAuth signature base string: POST&https%3A%2F%2Fapi.discogs.com%2Foauth%2Faccess_token&oauth_consumer_key%3Dtest-consumer-key%26oauth_nonce%3DPY6W4UcSxQzSPIqNzGnuZda0f86HN3wU%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_token%3Drequest-token%26oauth_verifier%3Dverifier%26oauth_version%3D1.0
OAuth signing key: test-consumer-secret&request-secret
OAuth signature: FMjwI94SP+mof4v/GwMkDTwR5Aw=

stdout | test/utils/retry.test.ts > Retry Utility > fetchWithRetry > should parse Retry-After header in seconds
Retry attempt 1/3 after 5238.016707311918ms delay

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getAccessToken > should handle access token errors
OAuth signature base string: POST&https%3A%2F%2Fapi.discogs.com%2Foauth%2Faccess_token&oauth_consumer_key%3Dtest-consumer-key%26oauth_nonce%3D0JVJBk18EPBk2WEOGxkfZOHaog6NeVZy%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_token%3Drequest-token%26oauth_verifier%3Dinvalid-verifier%26oauth_version%3D1.0
OAuth signing key: test-consumer-secret&request-secret
OAuth signature: E/iJ99laOdrK3xNksEy1LgceerU=

stdout | test/utils/retry.test.ts > Retry Utility > fetchWithRetry > should parse Retry-After header as HTTP date
Retry attempt 1/3 after 3065.5024708542046ms delay

stderr | test/auth/discogs.spec.ts > DiscogsAuth > getAccessToken > should handle access token errors
Discogs API error: ResponseError: HTTP 401: Unauthorized
    at withRetry (/Users/rian/Documents/GitHub/discogs-mcp/src/utils/retry.ts:178:11)
    at withRetry (/Users/rian/Documents/GitHub/discogs-mcp/src/utils/retry.ts:108:17)
    at fetchWithRetry (/Users/rian/Documents/GitHub/discogs-mcp/src/utils/retry.ts:171:17)
    at DiscogsAuth.getAccessToken (/Users/rian/Documents/GitHub/discogs-mcp/src/auth/discogs.ts:244:21)
    at /Users/rian/Documents/GitHub/discogs-mcp/test/auth/discogs.spec.ts:127:4
    at Users/rian/Documents/GitHub/discogs-mcp/node_modules/@vitest/runner/dist/index.js:573:22 {
  response: {
    ok: false,
    status: 401,
    statusText: 'Unauthorized',
    text: [Function: text]
  }
}

 ‚úì test/utils/kvLogger.test.ts (6 tests) 279ms
stdout | test/auth/discogs.spec.ts > DiscogsAuth > getAccessToken > should handle malformed access token responses
OAuth signature base string: POST&https%3A%2F%2Fapi.discogs.com%2Foauth%2Faccess_token&oauth_consumer_key%3Dtest-consumer-key%26oauth_nonce%3DZAR7Aed9CmiTvealzBEuiDiNGjglrP7e%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_token%3Drequest-token%26oauth_verifier%3Dverifier%26oauth_version%3D1.0
OAuth signing key: test-consumer-secret&request-secret
OAuth signature: zgkA1JiicxPZZOB5cWsq9Fo9+v4=

stderr | test/auth/discogs.spec.ts > DiscogsAuth > getAccessToken > should handle malformed access token responses
Discogs API error: Error: Invalid response from Discogs: missing oauth_token or oauth_token_secret
    at DiscogsAuth.getAccessToken (/Users/rian/Documents/GitHub/discogs-mcp/src/auth/discogs.ts:265:11)
    at /Users/rian/Documents/GitHub/discogs-mcp/test/auth/discogs.spec.ts:140:4
    at Users/rian/Documents/GitHub/discogs-mcp/node_modules/@vitest/runner/dist/index.js:573:22

stdout | test/utils/retry.test.ts > Retry Utility > fetchWithRetry > should retry on 5xx errors
Retry attempt 1/3 after 108.62412272328194ms delay

stdout | test/auth/discogs.spec.ts > DiscogsAuth > getAuthHeaders > should generate correct auth headers for API requests
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftest&oauth_consumer_key%3Dtest-consumer-key%26oauth_nonce%3DqcPdpTa8TvDMqHbe42el7bOtjWKt4w7t%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_token%3Daccess-token%26oauth_version%3D1.0
OAuth signing key: test-consumer-secret&access-secret
OAuth signature: wTKKPeZaSPthpJiAoz0VT2mMLek=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should filter by album title when query is provided
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3Dv17tRcI8zkHHKDuShMKovjBT0d41PrXa%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: ixSEVaGRK7SSk/Kk6Z8dRywYJdg=

stdout | test/auth/discogs.spec.ts > DiscogsAuth > OAuth signature generation > should generate consistent signatures for the same parameters
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Ftest&oauth_consumer_key%3Dtest-consumer-key%26oauth_nonce%3Dffffffffffffffffffffffffffffffff%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1672531200%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-consumer-secret&test-secret
OAuth signature: g06ttDnmU3albDFhbKWiPttm5uk=

stdout | test/auth/discogs.spec.ts > DiscogsAuth > OAuth signature generation > should generate consistent signatures for the same parameters
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Ftest&oauth_consumer_key%3Dtest-consumer-key%26oauth_nonce%3Dffffffffffffffffffffffffffffffff%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1672531200%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-consumer-secret&test-secret
OAuth signature: g06ttDnmU3albDFhbKWiPttm5uk=

 ‚úì test/utils/retry.test.ts (9 tests) 323ms
 ‚úì test/utils/moodMapping.test.ts (10 tests) 313ms
 ‚úì test/auth/discogs.spec.ts (9 tests) 364ms
 ‚úì test/utils/rateLimit.test.ts (15 tests) 454ms
stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should filter by genre when query is provided
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3D2uihs7xiE3PW28mHZZaqj5Hgr3khYUBg%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: RPDFYCDQOfyeZYsHt+DFbCkXL+M=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should return empty results when no matches found
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3D10iMxgP19w4SE33FZ1Y0SadBICru26V4%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: Qw0SjRaLDsXMYBxX84cu6WD6cuA=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should handle case-insensitive search
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DztpTRltvUHbD0E1bavECwTG8HFviy8e7%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: YO6TdivQnIdkz1+9mkWJxyNIfsw=

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle initialize request
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 141 Text: event: message
data: {"jsonrpc":"2.0","id":2,"error":{"code":-32602,"message":"MCP error -32602: Resource discogs://collection not found"}}



stdout | test/index.spec.ts > Discogs MCP Server > should handle empty body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 418 Text: event: message
data: {"result":{"resources":[{"uri":"Complete Discogs collection for the authenticated user","name":"discogs://collection"},{"uri":"Detailed information about a specific Discogs releas

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 141 Text: event: message
data: {"jsonrpc":"2.0","id":3,"error":{"code":-32602,"message":"MCP error -32602: Resource discogs://collection not found"}}



stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should find releases with multi-word queries like "Miles Davis Kind of Blue"
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DYn64oKEfYxXz5LkJ9a1G8loPL7CSBfjS%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810473%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: xMOSjupQuK2vA+qsdrWonAWAhMQ=

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 2 failed) 79ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources 21ms
     ‚Üí expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 11ms
     ‚Üí Cannot read properties of undefined (reading 'contents')
 ‚ùØ test/index.spec.ts (7 tests | 6 failed) 90ms
   √ó Discogs MCP Server > should handle initialize request 13ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should return server info for GET requests to main endpoint 4ms
     ‚Üí expected { name: 'Discogs MCP Server', ‚Ä¶(3) } to match object { name: 'Discogs MCP Server', ‚Ä¶(3) }
   √ó Discogs MCP Server > should handle parse errors 5ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 4ms
     ‚Üí expected 404 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   √ó Discogs MCP Server > SSE endpoint > should accept GET requests to /sse 3ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > SSE endpoint > should accept POST requests to /sse for JSON-RPC 2ms
     ‚Üí expected 404 to be 200 // Object.is equality
 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 91ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 13ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 4ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 4ms
     ‚Üí expected 404 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 4ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 6ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 5ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 4ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))
stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should handle decade queries like "1960s" matching years in that decade
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3D4FZEetuG1xIsAFa2P7G3Rq4GPptXRZdI%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810474%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: Snx8rjh0s9rPYTKIxcePTQHmN4M=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should handle multiple decades with OR logic (1960s OR 1970s)
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DK1tn5KAH4nI6cXHTxzJtFZUiBJxP15Un%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810474%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: 4T+IZrHsS/+GDgeuzBwPdnHkFIA=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should handle complex style and decade queries like "post-bop 1960s 1970s vinyl"
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DjdgflW5uxPkXoibJ7ENZqoKoxLCxBWPQ%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810474%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: MWVLcm1tlAba7+xhM9j3RiGID3Q=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should find release by specific ID 654321
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DAF84xfCAIhAXORQGK8TXhYkkfabPQPTa%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810474%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: L44wTlOvxNIdZCRqSinpVY11znA=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should handle temporal queries like "rock vinyl recent"
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DZXOTpzkoiunE2Hh4wOOGZ8q3MopyPKmy%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810474%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: xLlFpeBQSHeR+QY8z66zZvhAobc=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should use OR logic for multi-word genre searches like "ambient drone progressive"
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DGt9vwk8I3LUMugp8F50M0IAD2n8rkrn3%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810474%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: OrnsiJH1s1AokqygwjKWjjFcELs=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should prioritize releases with more matching terms using relevance scoring
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DbzgvnnG0IF2kK08UNt1x96u9DigjT3Pz%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810474%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: zPNpIGvW9KXCYLx6opg6wUJNRno=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should prioritize mood-relevant releases for contextual queries like "cooking dinner mellow upbeat background"
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DViv8wzvV6ejLHIY4iHa6sxroG4LbAjNb%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810475%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: 9zxmvyjMOYijDFuWTfP9R4CdoEI=

stdout | test/clients/discogs.test.ts > Discogs Client > searchCollection > should not trigger mood detection for specific album searches like "Dark Side of the Moon"
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DRNmOrpFmjcWA4X3sEq3oGNUbmeWZf0Ei%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810475%26oauth_token%3Dtest-token%26oauth_version%3D1.0
OAuth signing key: test-secret-key&test-secret
OAuth signature: Hdb+0BxksyiLqxhwe2Ti5JCmdLA=

 ‚úì test/clients/discogs.test.ts (16 tests) 2281ms

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 15 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle initialize request
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:33:27
     31|   await waitOnExecutionContext(ctx)
     32| 
     33|   expect(response.status).toBe(200)
       |                           ^
     34|   expect(response.headers.get('content-type')).toBe('application/json')
     35| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should return server info for GET requests to main endpoint
AssertionError: expected { name: 'Discogs MCP Server', ‚Ä¶(3) } to match object { name: 'Discogs MCP Server', ‚Ä¶(3) }

- Expected
+ Received

  {
-   "description": "Model Context Protocol server for Discogs collection access",
+   "description": "Model Context Protocol server for Discogs collection access (SDK-based)",
    "endpoints": Any<Object>,
    "name": "Discogs MCP Server",
    "version": "1.0.0",
  }

 ‚ùØ Proxy.methodWrapper Users/rian/Documents/GitHub/discogs-mcp/node_modules/.vite/vitest/deps_ssr/chai.js:1537:25
 ‚ùØ test/index.spec.ts:66:18
     64| 
     65|   const result = await response.json()
     66|   expect(result).toMatchObject({
       |                  ^
     67|    name: 'Discogs MCP Server',
     68|    version: '1.0.0',

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle parse errors
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:84:27
     82|   await waitOnExecutionContext(ctx)
     83| 
     84|   expect(response.status).toBe(200) // JSON-RPC errors still return 200
       |                           ^
     85|   const result = await response.json()
     86|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle empty body
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:106:27
    104|   await waitOnExecutionContext(ctx)
    105| 
    106|   expect(response.status).toBe(200)
       |                           ^
    107|   const result = await response.json()
    108|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > SSE endpoint > should accept GET requests to /sse
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:134:28
    132|    await waitOnExecutionContext(ctx)
    133| 
    134|    expect(response.status).toBe(200)
       |                            ^
    135|    expect(response.headers.get('content-type')).toBe('text/event-strea‚Ä¶
    136|    expect(response.headers.get('cache-control')).toBe('no-cache')

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > SSE endpoint > should accept POST requests to /sse for JSON-RPC
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:165:28
    163|    await waitOnExecutionContext(ctx)
    164| 
    165|    expect(response.status).toBe(200)
       |                            ^
    166|    expect(response.headers.get('content-type')).toBe('application/json‚Ä¶
    167| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:60:27
     58|   const response = await worker.fetch(request, mockEnv, {} as any)
     59| 
     60|   expect(response.status).toBe(200)
       |                           ^
     61| 
     62|   // Verify logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:89:27
     87|   const response = await worker.fetch(request, mockEnv, {} as any)
     88| 
     89|   expect(response.status).toBe(200)
       |                           ^
     90| 
     91|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
AssertionError: expected 404 to be 429 // Object.is equality

- Expected
+ Received

- 429
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:125:27
    123|   const response = await worker.fetch(request, mockEnv, {} as any)
    124| 
    125|   expect(response.status).toBe(429)
       |                           ^
    126|   expect(response.headers.get('Retry-After')).toBeDefined()
    127| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:167:27
    165| 
    166|   // Should succeed despite rate limit
    167|   expect(response.status).toBe(200)
       |                           ^
    168| 
    169|   // Rate limiting should not have been checked for initialize

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:207:27
    205| 
    206|   // Should still work without KV namespaces
    207|   expect(response.status).toBe(200)
       |                           ^
    208| 
    209|   // No KV operations should have been attempted

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:223:27
    221|   const response = await worker.fetch(request, mockEnv, {} as any)
    222| 
    223|   expect(response.status).toBe(200)
       |                           ^
    224| 
    225|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/integration/logging-ratelimit.test.ts:262:24
    260|   const endTime = Date.now()
    261| 
    262|   const [, logValue] = mockMCP_LOGS.put.mock.calls[0]
       |                        ^
    263|   const logEntry = JSON.parse(logValue)
    264| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[13/15]‚éØ

 FAIL  test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
AssertionError: expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)

- Expected
+ Received

  {
    "error": {
-     "code": -32001,
+     "code": -32602,
    },
    "jsonrpc": "2.0",
  }

 ‚ùØ Proxy.methodWrapper Users/rian/Documents/GitHub/discogs-mcp/node_modules/.vite/vitest/deps_ssr/chai.js:1537:25
 ‚ùØ test/integration/mcp-client.test.ts:347:19
    345|    const result = await client.readResource('discogs://collection')
    346| 
    347|    expect(result).toMatchObject({
       |                   ^
    348|     jsonrpc: '2.0',
    349|     error: {

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[14/15]‚éØ

 FAIL  test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
TypeError: Cannot read properties of undefined (reading 'contents')
 ‚ùØ test/integration/mcp-client.test.ts:365:37
    363| 
    364|    const collectionResource = await client.readResource('discogs://col‚Ä¶
    365|    expect(collectionResource.result.contents).toBeDefined()
       |                                     ^
    366| 
    367|    // Test tools

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[15/15]‚éØ


 Test Files  3 failed | 6 passed (9)
      Tests  15 failed | 67 passed (82)
   Start at  06:54:30
   Duration  4.54s (transform 864ms, setup 0ms, collect 4.08s, tests 4.27s, environment 1ms, prepare 2.69s)

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  src/mcp/resources/discogs.ts 

[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle initialize request
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 141 Text: event: message
data: {"jsonrpc":"2.0","id":2,"error":{"code":-32602,"message":"MCP error -32602: Resource discogs://collection not found"}}



stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 418 Text: event: message
data: {"result":{"resources":[{"uri":"Complete Discogs collection for the authenticated user","name":"discogs://collection"},{"uri":"Detailed information about a specific Discogs releas

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 141 Text: event: message
data: {"jsonrpc":"2.0","id":3,"error":{"code":-32602,"message":"MCP error -32602: Resource discogs://collection not found"}}



stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle empty body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 2 failed) 1190ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources 59ms
     ‚Üí expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 23ms
     ‚Üí Cannot read properties of undefined (reading 'contents')
stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 1376ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 203ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 10ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 153ms
     ‚Üí expected 404 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 16ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 8ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 31ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 8ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/index.spec.ts (7 tests | 6 failed) 1855ms
   √ó Discogs MCP Server > should handle initialize request 55ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should return server info for GET requests to main endpoint 79ms
     ‚Üí expected { name: 'Discogs MCP Server', ‚Ä¶(3) } to match object { name: 'Discogs MCP Server', ‚Ä¶(3) }
   √ó Discogs MCP Server > should handle parse errors 49ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 55ms
     ‚Üí expected 404 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   √ó Discogs MCP Server > SSE endpoint > should accept GET requests to /sse 14ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > SSE endpoint > should accept POST requests to /sse for JSON-RPC 9ms
     ‚Üí expected 404 to be 200 // Object.is equality

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 15 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:60:27
     58|   const response = await worker.fetch(request, mockEnv, {} as any)
     59| 
     60|   expect(response.status).toBe(200)
       |                           ^
     61| 
     62|   // Verify logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:89:27
     87|   const response = await worker.fetch(request, mockEnv, {} as any)
     88| 
     89|   expect(response.status).toBe(200)
       |                           ^
     90| 
     91|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
AssertionError: expected 404 to be 429 // Object.is equality

- Expected
+ Received

- 429
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:125:27
    123|   const response = await worker.fetch(request, mockEnv, {} as any)
    124| 
    125|   expect(response.status).toBe(429)
       |                           ^
    126|   expect(response.headers.get('Retry-After')).toBeDefined()
    127| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:167:27
    165| 
    166|   // Should succeed despite rate limit
    167|   expect(response.status).toBe(200)
       |                           ^
    168| 
    169|   // Rate limiting should not have been checked for initialize

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:207:27
    205| 
    206|   // Should still work without KV namespaces
    207|   expect(response.status).toBe(200)
       |                           ^
    208| 
    209|   // No KV operations should have been attempted

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:223:27
    221|   const response = await worker.fetch(request, mockEnv, {} as any)
    222| 
    223|   expect(response.status).toBe(200)
       |                           ^
    224| 
    225|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/integration/logging-ratelimit.test.ts:262:24
    260|   const endTime = Date.now()
    261| 
    262|   const [, logValue] = mockMCP_LOGS.put.mock.calls[0]
       |                        ^
    263|   const logEntry = JSON.parse(logValue)
    264| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/15]‚éØ

 FAIL  test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
AssertionError: expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)

- Expected
+ Received

  {
    "error": {
-     "code": -32001,
+     "code": -32602,
    },
    "jsonrpc": "2.0",
  }

 ‚ùØ Proxy.methodWrapper Users/rian/Documents/GitHub/discogs-mcp/node_modules/.vite/vitest/deps_ssr/chai.js:1537:25
 ‚ùØ test/integration/mcp-client.test.ts:347:19
    345|    const result = await client.readResource('discogs://collection')
    346| 
    347|    expect(result).toMatchObject({
       |                   ^
    348|     jsonrpc: '2.0',
    349|     error: {

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/15]‚éØ

 FAIL  test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
TypeError: Cannot read properties of undefined (reading 'contents')
 ‚ùØ test/integration/mcp-client.test.ts:365:37
    363| 
    364|    const collectionResource = await client.readResource('discogs://col‚Ä¶
    365|    expect(collectionResource.result.contents).toBeDefined()
       |                                     ^
    366| 
    367|    // Test tools

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle initialize request
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:33:27
     31|   await waitOnExecutionContext(ctx)
     32| 
     33|   expect(response.status).toBe(200)
       |                           ^
     34|   expect(response.headers.get('content-type')).toBe('application/json')
     35| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should return server info for GET requests to main endpoint
AssertionError: expected { name: 'Discogs MCP Server', ‚Ä¶(3) } to match object { name: 'Discogs MCP Server', ‚Ä¶(3) }

- Expected
+ Received

  {
-   "description": "Model Context Protocol server for Discogs collection access",
+   "description": "Model Context Protocol server for Discogs collection access (SDK-based)",
    "endpoints": Any<Object>,
    "name": "Discogs MCP Server",
    "version": "1.0.0",
  }

 ‚ùØ Proxy.methodWrapper Users/rian/Documents/GitHub/discogs-mcp/node_modules/.vite/vitest/deps_ssr/chai.js:1537:25
 ‚ùØ test/index.spec.ts:66:18
     64| 
     65|   const result = await response.json()
     66|   expect(result).toMatchObject({
       |                  ^
     67|    name: 'Discogs MCP Server',
     68|    version: '1.0.0',

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle parse errors
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:84:27
     82|   await waitOnExecutionContext(ctx)
     83| 
     84|   expect(response.status).toBe(200) // JSON-RPC errors still return 200
       |                           ^
     85|   const result = await response.json()
     86|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle empty body
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:106:27
    104|   await waitOnExecutionContext(ctx)
    105| 
    106|   expect(response.status).toBe(200)
       |                           ^
    107|   const result = await response.json()
    108|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[13/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > SSE endpoint > should accept GET requests to /sse
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:134:28
    132|    await waitOnExecutionContext(ctx)
    133| 
    134|    expect(response.status).toBe(200)
       |                            ^
    135|    expect(response.headers.get('content-type')).toBe('text/event-strea‚Ä¶
    136|    expect(response.headers.get('cache-control')).toBe('no-cache')

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[14/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > SSE endpoint > should accept POST requests to /sse for JSON-RPC
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:165:28
    163|    await waitOnExecutionContext(ctx)
    164| 
    165|    expect(response.status).toBe(200)
       |                            ^
    166|    expect(response.headers.get('content-type')).toBe('application/json‚Ä¶
    167| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[15/15]‚éØ


 Test Files  3 failed (3)
      Tests  15 failed | 2 passed (17)
   Start at  06:57:29
   Duration  6.80s

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/integration/mcp-client.test.ts x2 

 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 1376ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 203ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 10ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 153ms
     ‚Üí expected 404 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 16ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 8ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 31ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 8ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/index.spec.ts (7 tests | 6 failed) 1855ms
   √ó Discogs MCP Server > should handle initialize request 55ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should return server info for GET requests to main endpoint 79ms
     ‚Üí expected { name: 'Discogs MCP Server', ‚Ä¶(3) } to match object { name: 'Discogs MCP Server', ‚Ä¶(3) }
   √ó Discogs MCP Server > should handle parse errors 49ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 55ms
     ‚Üí expected 404 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   √ó Discogs MCP Server > SSE endpoint > should accept GET requests to /sse 14ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > SSE endpoint > should accept POST requests to /sse for JSON-RPC 9ms
     ‚Üí expected 404 to be 200 // Object.is equality
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 141 Text: event: message
data: {"jsonrpc":"2.0","id":2,"error":{"code":-32602,"message":"MCP error -32602: Resource discogs://collection not found"}}



stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 418 Text: event: message
data: {"result":{"resources":[{"uri":"Complete Discogs collection for the authenticated user","name":"discogs://collection"},{"uri":"Detailed information about a specific Discogs releas

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 141 Text: event: message
data: {"jsonrpc":"2.0","id":3,"error":{"code":-32602,"message":"MCP error -32602: Resource discogs://collection not found"}}



 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 1 failed) 97ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 12ms
     ‚Üí Cannot read properties of undefined (reading 'contents')

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 1 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
TypeError: Cannot read properties of undefined (reading 'contents')
 ‚ùØ test/integration/mcp-client.test.ts:365:37
    363| 
    364|    const collectionResource = await client.readResource('discogs://col‚Ä¶
    365|    expect(collectionResource.result.contents).toBeDefined()
       |                                     ^
    366| 
    367|    // Test tools

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/1]‚éØ


 Test Files  3 failed (3)
      Tests  14 failed | 3 passed (17)
   Start at  06:57:33
   Duration  501ms

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  src/mcp/resources/discogs.ts 

[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle initialize request
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Session ID extraction: { providedSessionId: 'mcp-efa543eedde602b1b37f96fe50283eb1' }
Looking up KV key: session:mcp-efa543eedde602b1b37f96fe50283eb1

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
No session found for key: session:mcp-efa543eedde602b1b37f96fe50283eb1

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 137 Text: event: message
data: {"jsonrpc":"2.0","id":2,"error":{"code":-32603,"message":"Authentication required to access collection resource"}}



stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 582 Text: event: message
data: {"result":{"resources":[{"uri":"discogs://collection","name":"collection","mimeType":"application/json","description":"Complete Discogs collection for the authenticated user"},{"u

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Session ID extraction: { providedSessionId: 'mcp-efa543eedde602b1b37f96fe50283eb1' }

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Fetching fresh data for userProfiles:test-access-token
Making OAuth request to /oauth/identity with token: test-acces...

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Foauth%2Fidentity&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DxETJvUTQ4QtjWStGHaLNTFkMf1eBw7Ux%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810702%26oauth_token%3Dtest-access-token%26oauth_version%3D1.0
OAuth signing key: test-secret&test-access-secret
OAuth signature: JqIbstjBlv7pD1lEufU/2ba6GE4=

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Fetching fresh data for collections:testuser:all:default:desc

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fper_page%3D100&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DCvZhiQg3dArG076G5TFUlywKbqlL7Lbl%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810702%26oauth_token%3Dtest-access-token%26oauth_version%3D1.0
OAuth signing key: test-secret&test-access-secret
OAuth signature: PgcKimx0Jlcv+2N2fnxbWdIXTRs=

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 2115 Text: event: message
data: {"result":{"contents":[{"uri":"discogs://collection","mimeType":"application/json","text":"{\n  \"releases\": [\n    {\n      \"id\": 123456,\n      \"instance_id\": 123456,\n    

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle empty body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 3681 Text: event: message
data: {"result":{"tools":[{"name":"ping","description":"Test connectivity to the Discogs MCP server","inputSchema":{"$schema":"http://json-schema.org/draft-07/schema#","type":"object","

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Session ID extraction: { providedSessionId: 'mcp-efa543eedde602b1b37f96fe50283eb1' }

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Fetching fresh data for userProfiles:test-access-token
Making OAuth request to /oauth/identity with token: test-acces...

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Foauth%2Fidentity&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DW2qonLO0COIaVwam7FPvdy5qE2zrT3WP%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810702%26oauth_token%3Dtest-access-token%26oauth_version%3D1.0
OAuth signing key: test-secret&test-access-secret
OAuth signature: 8BNTS9L2wFn9Ma+fQLTTyrqQ8QE=

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Fetching fresh data for searches:testuser:Beatles:1

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3D3Wq1gRdxU0ACyZDWuGPmrSqEbh805G7W%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765810702%26oauth_token%3Dtest-access-token%26oauth_version%3D1.0
OAuth signing key: test-secret&test-access-secret
OAuth signature: +sPMZw+lrVVgXFffJ86jHbc7oTg=

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 372 Text: event: message
data: {"result":{"content":[{"type":"text","text":"Found 1 results for \"Beatles\" in your collection (showing 1 items):\n‚Ä¢ [ID: 123456] The Beatles - Abbey Road (1969)\n  Format: Vinyl

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 421 Text: event: message
data: {"result":{"prompts":[{"name":"browse_collection","description":"Browse and explore your Discogs music collection","arguments":[]},{"name":"find_music","description":"Find specifi

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 1 failed) 956ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources 63ms
     ‚Üí expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 389ms
 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 1050ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 82ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 42ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 31ms
     ‚Üí expected 404 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 18ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 26ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 6ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 6ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/index.spec.ts (7 tests | 6 failed) 1036ms
   √ó Discogs MCP Server > should handle initialize request 135ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should return server info for GET requests to main endpoint 22ms
     ‚Üí expected { name: 'Discogs MCP Server', ‚Ä¶(3) } to match object { name: 'Discogs MCP Server', ‚Ä¶(3) }
   √ó Discogs MCP Server > should handle parse errors 21ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 17ms
     ‚Üí expected 404 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   √ó Discogs MCP Server > SSE endpoint > should accept GET requests to /sse 7ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > SSE endpoint > should accept POST requests to /sse for JSON-RPC 15ms
     ‚Üí expected 404 to be 200 // Object.is equality

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 14 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:60:27
     58|   const response = await worker.fetch(request, mockEnv, {} as any)
     59| 
     60|   expect(response.status).toBe(200)
       |                           ^
     61| 
     62|   // Verify logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/14]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:89:27
     87|   const response = await worker.fetch(request, mockEnv, {} as any)
     88| 
     89|   expect(response.status).toBe(200)
       |                           ^
     90| 
     91|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/14]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
AssertionError: expected 404 to be 429 // Object.is equality

- Expected
+ Received

- 429
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:125:27
    123|   const response = await worker.fetch(request, mockEnv, {} as any)
    124| 
    125|   expect(response.status).toBe(429)
       |                           ^
    126|   expect(response.headers.get('Retry-After')).toBeDefined()
    127| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/14]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:167:27
    165| 
    166|   // Should succeed despite rate limit
    167|   expect(response.status).toBe(200)
       |                           ^
    168| 
    169|   // Rate limiting should not have been checked for initialize

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/14]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:207:27
    205| 
    206|   // Should still work without KV namespaces
    207|   expect(response.status).toBe(200)
       |                           ^
    208| 
    209|   // No KV operations should have been attempted

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/14]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:223:27
    221|   const response = await worker.fetch(request, mockEnv, {} as any)
    222| 
    223|   expect(response.status).toBe(200)
       |                           ^
    224| 
    225|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/14]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/integration/logging-ratelimit.test.ts:262:24
    260|   const endTime = Date.now()
    261| 
    262|   const [, logValue] = mockMCP_LOGS.put.mock.calls[0]
       |                        ^
    263|   const logEntry = JSON.parse(logValue)
    264| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/14]‚éØ

 FAIL  test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
AssertionError: expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)

- Expected
+ Received

  {
    "error": {
-     "code": -32602,
+     "code": -32603,
    },
    "jsonrpc": "2.0",
  }

 ‚ùØ Proxy.methodWrapper Users/rian/Documents/GitHub/discogs-mcp/node_modules/.vite/vitest/deps_ssr/chai.js:1537:25
 ‚ùØ test/integration/mcp-client.test.ts:347:19
    345|    const result = await client.readResource('discogs://collection')
    346| 
    347|    expect(result).toMatchObject({
       |                   ^
    348|     jsonrpc: '2.0',
    349|     error: {

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/14]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle initialize request
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:33:27
     31|   await waitOnExecutionContext(ctx)
     32| 
     33|   expect(response.status).toBe(200)
       |                           ^
     34|   expect(response.headers.get('content-type')).toBe('application/json')
     35| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/14]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should return server info for GET requests to main endpoint
AssertionError: expected { name: 'Discogs MCP Server', ‚Ä¶(3) } to match object { name: 'Discogs MCP Server', ‚Ä¶(3) }

- Expected
+ Received

  {
-   "description": "Model Context Protocol server for Discogs collection access",
+   "description": "Model Context Protocol server for Discogs collection access (SDK-based)",
    "endpoints": Any<Object>,
    "name": "Discogs MCP Server",
    "version": "1.0.0",
  }

 ‚ùØ Proxy.methodWrapper Users/rian/Documents/GitHub/discogs-mcp/node_modules/.vite/vitest/deps_ssr/chai.js:1537:25
 ‚ùØ test/index.spec.ts:66:18
     64| 
     65|   const result = await response.json()
     66|   expect(result).toMatchObject({
       |                  ^
     67|    name: 'Discogs MCP Server',
     68|    version: '1.0.0',

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/14]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle parse errors
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:84:27
     82|   await waitOnExecutionContext(ctx)
     83| 
     84|   expect(response.status).toBe(200) // JSON-RPC errors still return 200
       |                           ^
     85|   const result = await response.json()
     86|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/14]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle empty body
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:106:27
    104|   await waitOnExecutionContext(ctx)
    105| 
    106|   expect(response.status).toBe(200)
       |                           ^
    107|   const result = await response.json()
    108|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/14]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > SSE endpoint > should accept GET requests to /sse
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:134:28
    132|    await waitOnExecutionContext(ctx)
    133| 
    134|    expect(response.status).toBe(200)
       |                            ^
    135|    expect(response.headers.get('content-type')).toBe('text/event-strea‚Ä¶
    136|    expect(response.headers.get('cache-control')).toBe('no-cache')

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[13/14]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > SSE endpoint > should accept POST requests to /sse for JSON-RPC
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:165:28
    163|    await waitOnExecutionContext(ctx)
    164| 
    165|    expect(response.status).toBe(200)
       |                            ^
    166|    expect(response.headers.get('content-type')).toBe('application/json‚Ä¶
    167| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[14/14]‚éØ


 Test Files  3 failed (3)
      Tests  14 failed | 3 passed (17)
   Start at  06:58:20
   Duration  4.19s

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  src/mcp/resources/discogs.ts 

[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle initialize request
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Session ID extraction: { providedSessionId: 'mcp-efa543eedde602b1b37f96fe50283eb1' }
Looking up KV key: session:mcp-efa543eedde602b1b37f96fe50283eb1

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
No session found for key: session:mcp-efa543eedde602b1b37f96fe50283eb1

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 137 Text: event: message
data: {"jsonrpc":"2.0","id":2,"error":{"code":-32603,"message":"Authentication required to access collection resource"}}



stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 224 Text: event: message
data: {"result":{"resources":[{"uri":"discogs://collection","name":"collection","mimeType":"application/json","description":"Complete Discogs collection for the authenticated user"}]},"

stdout | test/index.spec.ts > Discogs MCP Server > should handle parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle empty body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 2 failed) 287ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources 21ms
     ‚Üí expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 28ms
     ‚Üí expected [ { ‚Ä¶(4) } ] to have a length of 3 but got 1
stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 396ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 11ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 39ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 9ms
     ‚Üí expected 404 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 14ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 6ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 33ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 4ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/index.spec.ts (7 tests | 6 failed) 466ms
   √ó Discogs MCP Server > should handle initialize request 41ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should return server info for GET requests to main endpoint 9ms
     ‚Üí expected { name: 'Discogs MCP Server', ‚Ä¶(3) } to match object { name: 'Discogs MCP Server', ‚Ä¶(3) }
   √ó Discogs MCP Server > should handle parse errors 13ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 10ms
     ‚Üí expected 404 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   √ó Discogs MCP Server > SSE endpoint > should accept GET requests to /sse 3ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > SSE endpoint > should accept POST requests to /sse for JSON-RPC 3ms
     ‚Üí expected 404 to be 200 // Object.is equality

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 15 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:60:27
     58|   const response = await worker.fetch(request, mockEnv, {} as any)
     59| 
     60|   expect(response.status).toBe(200)
       |                           ^
     61| 
     62|   // Verify logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:89:27
     87|   const response = await worker.fetch(request, mockEnv, {} as any)
     88| 
     89|   expect(response.status).toBe(200)
       |                           ^
     90| 
     91|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
AssertionError: expected 404 to be 429 // Object.is equality

- Expected
+ Received

- 429
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:125:27
    123|   const response = await worker.fetch(request, mockEnv, {} as any)
    124| 
    125|   expect(response.status).toBe(429)
       |                           ^
    126|   expect(response.headers.get('Retry-After')).toBeDefined()
    127| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:167:27
    165| 
    166|   // Should succeed despite rate limit
    167|   expect(response.status).toBe(200)
       |                           ^
    168| 
    169|   // Rate limiting should not have been checked for initialize

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:207:27
    205| 
    206|   // Should still work without KV namespaces
    207|   expect(response.status).toBe(200)
       |                           ^
    208| 
    209|   // No KV operations should have been attempted

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:223:27
    221|   const response = await worker.fetch(request, mockEnv, {} as any)
    222| 
    223|   expect(response.status).toBe(200)
       |                           ^
    224| 
    225|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/15]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/integration/logging-ratelimit.test.ts:262:24
    260|   const endTime = Date.now()
    261| 
    262|   const [, logValue] = mockMCP_LOGS.put.mock.calls[0]
       |                        ^
    263|   const logEntry = JSON.parse(logValue)
    264| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/15]‚éØ

 FAIL  test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
AssertionError: expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)

- Expected
+ Received

  {
    "error": {
-     "code": -32602,
+     "code": -32603,
    },
    "jsonrpc": "2.0",
  }

 ‚ùØ Proxy.methodWrapper Users/rian/Documents/GitHub/discogs-mcp/node_modules/.vite/vitest/deps_ssr/chai.js:1537:25
 ‚ùØ test/integration/mcp-client.test.ts:347:19
    345|    const result = await client.readResource('discogs://collection')
    346| 
    347|    expect(result).toMatchObject({
       |                   ^
    348|     jsonrpc: '2.0',
    349|     error: {

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/15]‚éØ

 FAIL  test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
AssertionError: expected [ { ‚Ä¶(4) } ] to have a length of 3 but got 1

- Expected
+ Received

- 3
+ 1

 ‚ùØ Proxy.methodWrapper Users/rian/Documents/GitHub/discogs-mcp/node_modules/.vite/vitest/deps_ssr/chai.js:1537:25
 ‚ùØ test/integration/mcp-client.test.ts:362:43
    360|    // Test resources
    361|    const resourcesList = await client.listResources()
    362|    expect(resourcesList.result.resources).toHaveLength(3)
       |                                           ^
    363| 
    364|    const collectionResource = await client.readResource('discogs://col‚Ä¶

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle initialize request
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:33:27
     31|   await waitOnExecutionContext(ctx)
     32| 
     33|   expect(response.status).toBe(200)
       |                           ^
     34|   expect(response.headers.get('content-type')).toBe('application/json')
     35| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should return server info for GET requests to main endpoint
AssertionError: expected { name: 'Discogs MCP Server', ‚Ä¶(3) } to match object { name: 'Discogs MCP Server', ‚Ä¶(3) }

- Expected
+ Received

  {
-   "description": "Model Context Protocol server for Discogs collection access",
+   "description": "Model Context Protocol server for Discogs collection access (SDK-based)",
    "endpoints": Any<Object>,
    "name": "Discogs MCP Server",
    "version": "1.0.0",
  }

 ‚ùØ Proxy.methodWrapper Users/rian/Documents/GitHub/discogs-mcp/node_modules/.vite/vitest/deps_ssr/chai.js:1537:25
 ‚ùØ test/index.spec.ts:66:18
     64| 
     65|   const result = await response.json()
     66|   expect(result).toMatchObject({
       |                  ^
     67|    name: 'Discogs MCP Server',
     68|    version: '1.0.0',

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle parse errors
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:84:27
     82|   await waitOnExecutionContext(ctx)
     83| 
     84|   expect(response.status).toBe(200) // JSON-RPC errors still return 200
       |                           ^
     85|   const result = await response.json()
     86|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle empty body
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:106:27
    104|   await waitOnExecutionContext(ctx)
    105| 
    106|   expect(response.status).toBe(200)
       |                           ^
    107|   const result = await response.json()
    108|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[13/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > SSE endpoint > should accept GET requests to /sse
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:134:28
    132|    await waitOnExecutionContext(ctx)
    133| 
    134|    expect(response.status).toBe(200)
       |                            ^
    135|    expect(response.headers.get('content-type')).toBe('text/event-strea‚Ä¶
    136|    expect(response.headers.get('cache-control')).toBe('no-cache')

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[14/15]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > SSE endpoint > should accept POST requests to /sse for JSON-RPC
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:165:28
    163|    await waitOnExecutionContext(ctx)
    164| 
    165|    expect(response.status).toBe(200)
       |                            ^
    166|    expect(response.headers.get('content-type')).toBe('application/json‚Ä¶
    167| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[15/15]‚éØ


 Test Files  3 failed (3)
      Tests  15 failed | 2 passed (17)
   Start at  06:59:16
   Duration  3.23s

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/index.spec.ts x4 

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 2 failed) 287ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources 21ms
     ‚Üí expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 28ms
     ‚Üí expected [ { ‚Ä¶(4) } ] to have a length of 3 but got 1
 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 396ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 11ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 39ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 9ms
     ‚Üí expected 404 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 14ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 6ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 33ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 4ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/index.spec.ts > Discogs MCP Server > should handle initialize request
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle empty body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/index.spec.ts (6 tests | 4 failed) 106ms
   √ó Discogs MCP Server > should handle initialize request 13ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should return server info for GET requests to main endpoint 2ms
     ‚Üí expected { name: 'Discogs MCP Server', ‚Ä¶(3) } to match object { name: 'Discogs MCP Server', ‚Ä¶(3) }
   √ó Discogs MCP Server > should handle parse errors 4ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 5ms
     ‚Üí expected 404 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   ‚úì Discogs MCP Server > should return 404 for unknown paths

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 4 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle initialize request
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:33:27
     31|   await waitOnExecutionContext(ctx)
     32| 
     33|   expect(response.status).toBe(200)
       |                           ^
     34|   expect(response.headers.get('content-type')).toBe('application/json')
     35| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/4]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should return server info for GET requests to main endpoint
AssertionError: expected { name: 'Discogs MCP Server', ‚Ä¶(3) } to match object { name: 'Discogs MCP Server', ‚Ä¶(3) }

- Expected
+ Received

  {
-   "description": "Model Context Protocol server for Discogs collection access",
+   "description": "Model Context Protocol server for Discogs collection access (SDK-based)",
    "endpoints": Any<Object>,
    "name": "Discogs MCP Server",
    "version": "1.0.0",
  }

 ‚ùØ Proxy.methodWrapper Users/rian/Documents/GitHub/discogs-mcp/node_modules/.vite/vitest/deps_ssr/chai.js:1537:25
 ‚ùØ test/index.spec.ts:66:18
     64| 
     65|   const result = await response.json()
     66|   expect(result).toMatchObject({
       |                  ^
     67|    name: 'Discogs MCP Server',
     68|    version: '1.0.0',

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/4]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle parse errors
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:84:27
     82|   await waitOnExecutionContext(ctx)
     83| 
     84|   expect(response.status).toBe(200) // JSON-RPC errors still return 200
       |                           ^
     85|   const result = await response.json()
     86|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/4]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle empty body
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/index.spec.ts:106:27
    104|   await waitOnExecutionContext(ctx)
    105| 
    106|   expect(response.status).toBe(200)
       |                           ^
    107|   const result = await response.json()
    108|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/4]‚éØ


 Test Files  3 failed (3)
      Tests  13 failed | 3 passed (16)
   Start at  06:59:44
   Duration  420ms

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/index.spec.ts x5 

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 2 failed) 287ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources 21ms
     ‚Üí expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 28ms
     ‚Üí expected [ { ‚Ä¶(4) } ] to have a length of 3 but got 1
 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 396ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 11ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 39ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 9ms
     ‚Üí expected 404 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 14ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 6ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 33ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 4ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/index.spec.ts > Discogs MCP Server > should handle initialize request
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle empty body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/index.spec.ts (6 tests | 3 failed) 129ms
   √ó Discogs MCP Server > should handle initialize request 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return server info for GET requests to main endpoint
   √ó Discogs MCP Server > should handle parse errors 9ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 5ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   ‚úì Discogs MCP Server > should return 404 for unknown paths

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 3 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle initialize request
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/index.spec.ts:33:27
     31|   await waitOnExecutionContext(ctx)
     32| 
     33|   expect(response.status).toBe(200)
       |                           ^
     34|   expect(response.headers.get('content-type')).toBe('application/json')
     35| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/3]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle parse errors
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/index.spec.ts:84:27
     82|   await waitOnExecutionContext(ctx)
     83| 
     84|   expect(response.status).toBe(200) // JSON-RPC errors still return 200
       |                           ^
     85|   const result = await response.json()
     86|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/3]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle empty body
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/index.spec.ts:106:27
    104|   await waitOnExecutionContext(ctx)
    105| 
    106|   expect(response.status).toBe(200)
       |                           ^
    107|   const result = await response.json()
    108|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/3]‚éØ


 Test Files  3 failed (3)
      Tests  12 failed | 4 passed (16)
   Start at  07:00:23
   Duration  566ms

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/integration/logging-ratelimit.test.ts x4 

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 2 failed) 287ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources 21ms
     ‚Üí expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 28ms
     ‚Üí expected [ { ‚Ä¶(4) } ] to have a length of 3 but got 1
 ‚ùØ test/index.spec.ts (6 tests | 3 failed) 129ms
   √ó Discogs MCP Server > should handle initialize request 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return server info for GET requests to main endpoint
   √ó Discogs MCP Server > should handle parse errors 9ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 5ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   ‚úì Discogs MCP Server > should return 404 for unknown paths
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 172ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 15ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 10ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 9ms
     ‚Üí expected 404 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 18ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 7ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 5ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 11ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 7 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:60:27
     58|   const response = await worker.fetch(request, mockEnv, {} as any)
     59| 
     60|   expect(response.status).toBe(200)
       |                           ^
     61| 
     62|   // Verify logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:89:27
     87|   const response = await worker.fetch(request, mockEnv, {} as any)
     88| 
     89|   expect(response.status).toBe(200)
       |                           ^
     90| 
     91|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
AssertionError: expected 404 to be 429 // Object.is equality

- Expected
+ Received

- 429
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:125:27
    123|   const response = await worker.fetch(request, mockEnv, {} as any)
    124| 
    125|   expect(response.status).toBe(429)
       |                           ^
    126|   expect(response.headers.get('Retry-After')).toBeDefined()
    127| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:167:27
    165| 
    166|   // Should succeed despite rate limit
    167|   expect(response.status).toBe(200)
       |                           ^
    168| 
    169|   // Rate limiting should not have been checked for initialize

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:207:27
    205| 
    206|   // Should still work without KV namespaces
    207|   expect(response.status).toBe(200)
       |                           ^
    208| 
    209|   // No KV operations should have been attempted

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:223:27
    221|   const response = await worker.fetch(request, mockEnv, {} as any)
    222| 
    223|   expect(response.status).toBe(200)
       |                           ^
    224| 
    225|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/integration/logging-ratelimit.test.ts:262:24
    260|   const endTime = Date.now()
    261| 
    262|   const [, logValue] = mockMCP_LOGS.put.mock.calls[0]
       |                        ^
    263|   const logEntry = JSON.parse(logValue)
    264| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/7]‚éØ


 Test Files  3 failed (3)
      Tests  12 failed | 4 passed (16)
   Start at  07:00:42
   Duration  490ms

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/integration/logging-ratelimit.test.ts x5 

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 2 failed) 287ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources 21ms
     ‚Üí expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 28ms
     ‚Üí expected [ { ‚Ä¶(4) } ] to have a length of 3 but got 1
 ‚ùØ test/index.spec.ts (6 tests | 3 failed) 129ms
   √ó Discogs MCP Server > should handle initialize request 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return server info for GET requests to main endpoint
   √ó Discogs MCP Server > should handle parse errors 9ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 5ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   ‚úì Discogs MCP Server > should return 404 for unknown paths
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 239ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 7ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 12ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 10ms
     ‚Üí expected 406 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 19ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 11ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 13ms
     ‚Üí expected 404 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 7ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 7 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:60:27
     58|   const response = await worker.fetch(request, mockEnv, {} as any)
     59| 
     60|   expect(response.status).toBe(200)
       |                           ^
     61| 
     62|   // Verify logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:89:27
     87|   const response = await worker.fetch(request, mockEnv, {} as any)
     88| 
     89|   expect(response.status).toBe(200)
       |                           ^
     90| 
     91|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
AssertionError: expected 406 to be 429 // Object.is equality

- Expected
+ Received

- 429
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:125:27
    123|   const response = await worker.fetch(request, mockEnv, {} as any)
    124| 
    125|   expect(response.status).toBe(429)
       |                           ^
    126|   expect(response.headers.get('Retry-After')).toBeDefined()
    127| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:167:27
    165| 
    166|   // Should succeed despite rate limit
    167|   expect(response.status).toBe(200)
       |                           ^
    168| 
    169|   // Rate limiting should not have been checked for initialize

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:207:27
    205| 
    206|   // Should still work without KV namespaces
    207|   expect(response.status).toBe(200)
       |                           ^
    208| 
    209|   // No KV operations should have been attempted

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 ‚ùØ test/integration/logging-ratelimit.test.ts:223:27
    221|   const response = await worker.fetch(request, mockEnv, {} as any)
    222| 
    223|   expect(response.status).toBe(200)
       |                           ^
    224| 
    225|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/integration/logging-ratelimit.test.ts:262:24
    260|   const endTime = Date.now()
    261| 
    262|   const [, logValue] = mockMCP_LOGS.put.mock.calls[0]
       |                        ^
    263|   const logEntry = JSON.parse(logValue)
    264| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/7]‚éØ


 Test Files  3 failed (3)
      Tests  12 failed | 4 passed (16)
   Start at  07:00:49
   Duration  348ms

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/integration/logging-ratelimit.test.ts x6 

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 2 failed) 287ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources 21ms
     ‚Üí expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 28ms
     ‚Üí expected [ { ‚Ä¶(4) } ] to have a length of 3 but got 1
 ‚ùØ test/index.spec.ts (6 tests | 3 failed) 129ms
   √ó Discogs MCP Server > should handle initialize request 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return server info for GET requests to main endpoint
   √ó Discogs MCP Server > should handle parse errors 9ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 5ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   ‚úì Discogs MCP Server > should return 404 for unknown paths
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 206ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 4ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 6ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 6ms
     ‚Üí expected 406 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 4ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 7ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 30ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 9ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 7 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:60:27
     58|   const response = await worker.fetch(request, mockEnv, {} as any)
     59| 
     60|   expect(response.status).toBe(200)
       |                           ^
     61| 
     62|   // Verify logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:89:27
     87|   const response = await worker.fetch(request, mockEnv, {} as any)
     88| 
     89|   expect(response.status).toBe(200)
       |                           ^
     90| 
     91|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
AssertionError: expected 406 to be 429 // Object.is equality

- Expected
+ Received

- 429
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:125:27
    123|   const response = await worker.fetch(request, mockEnv, {} as any)
    124| 
    125|   expect(response.status).toBe(429)
       |                           ^
    126|   expect(response.headers.get('Retry-After')).toBeDefined()
    127| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:167:27
    165| 
    166|   // Should succeed despite rate limit
    167|   expect(response.status).toBe(200)
       |                           ^
    168| 
    169|   // Rate limiting should not have been checked for initialize

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:207:27
    205| 
    206|   // Should still work without KV namespaces
    207|   expect(response.status).toBe(200)
       |                           ^
    208| 
    209|   // No KV operations should have been attempted

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:223:27
    221|   const response = await worker.fetch(request, mockEnv, {} as any)
    222| 
    223|   expect(response.status).toBe(200)
       |                           ^
    224| 
    225|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/integration/logging-ratelimit.test.ts:262:24
    260|   const endTime = Date.now()
    261| 
    262|   const [, logValue] = mockMCP_LOGS.put.mock.calls[0]
       |                        ^
    263|   const logEntry = JSON.parse(logValue)
    264| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/7]‚éØ


 Test Files  3 failed (3)
      Tests  12 failed | 4 passed (16)
   Start at  07:00:51
   Duration  435ms

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/index.spec.ts x6 

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 2 failed) 287ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources 21ms
     ‚Üí expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 28ms
     ‚Üí expected [ { ‚Ä¶(4) } ] to have a length of 3 but got 1
 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 206ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 4ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 6ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 6ms
     ‚Üí expected 406 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 4ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 7ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 30ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 9ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/index.spec.ts > Discogs MCP Server > should handle initialize request
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle empty body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/index.spec.ts (6 tests | 3 failed) 166ms
   √ó Discogs MCP Server > should handle initialize request 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return server info for GET requests to main endpoint
   √ó Discogs MCP Server > should handle parse errors 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 13ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   ‚úì Discogs MCP Server > should return 404 for unknown paths

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 3 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle initialize request
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/index.spec.ts:34:27
     32|   await waitOnExecutionContext(ctx)
     33| 
     34|   expect(response.status).toBe(200)
       |                           ^
     35|   expect(response.headers.get('content-type')).toBe('application/json')
     36| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/3]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle parse errors
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/index.spec.ts:89:11
     87|   await waitOnExecutionContext(ctx)
     88| 
     89|   expect(response.status).toBe(200) // JSON-RPC errors still return 200
       |           ^
     90|   const result = await response.json()
     91|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/3]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle empty body
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/index.spec.ts:115:4
    113|   await waitOnExecutionContext(ctx)
    114| 
    115|   expect(response.status).toBe(200)
       |    ^
    116|   const result = await response.json()
    117|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/3]‚éØ


 Test Files  3 failed (3)
      Tests  12 failed | 4 passed (16)
   Start at  07:02:24
   Duration  766ms

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/integration/logging-ratelimit.test.ts x7 

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 2 failed) 287ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources 21ms
     ‚Üí expected { jsonrpc: '2.0', id: 2, ‚Ä¶(1) } to match object { jsonrpc: '2.0', ‚Ä¶(1) }
(2 matching properties omitted from actual)
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 28ms
     ‚Üí expected [ { ‚Ä¶(4) } ] to have a length of 3 but got 1
 ‚ùØ test/index.spec.ts (6 tests | 3 failed) 166ms
   √ó Discogs MCP Server > should handle initialize request 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return server info for GET requests to main endpoint
   √ó Discogs MCP Server > should handle parse errors 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 13ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   ‚úì Discogs MCP Server > should return 404 for unknown paths
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 281ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 15ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 15ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 35ms
     ‚Üí expected 406 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 13ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 7ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 5ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 7 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:60:27
     58|   const response = await worker.fetch(request, mockEnv, {} as any)
     59| 
     60|   expect(response.status).toBe(200)
       |                           ^
     61| 
     62|   // Verify logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:89:27
     87|   const response = await worker.fetch(request, mockEnv, {} as any)
     88| 
     89|   expect(response.status).toBe(200)
       |                           ^
     90| 
     91|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
AssertionError: expected 406 to be 429 // Object.is equality

- Expected
+ Received

- 429
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:125:27
    123|   const response = await worker.fetch(request, mockEnv, {} as any)
    124| 
    125|   expect(response.status).toBe(429)
       |                           ^
    126|   expect(response.headers.get('Retry-After')).toBeDefined()
    127| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:167:27
    165| 
    166|   // Should succeed despite rate limit
    167|   expect(response.status).toBe(200)
       |                           ^
    168| 
    169|   // Rate limiting should not have been checked for initialize

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:207:27
    205| 
    206|   // Should still work without KV namespaces
    207|   expect(response.status).toBe(200)
       |                           ^
    208| 
    209|   // No KV operations should have been attempted

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:223:27
    221|   const response = await worker.fetch(request, mockEnv, {} as any)
    222| 
    223|   expect(response.status).toBe(200)
       |                           ^
    224| 
    225|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/integration/logging-ratelimit.test.ts:262:24
    260|   const endTime = Date.now()
    261| 
    262|   const [, logValue] = mockMCP_LOGS.put.mock.calls[0]
       |                        ^
    263|   const logEntry = JSON.parse(logValue)
    264| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/7]‚éØ


 Test Files  3 failed (3)
      Tests  12 failed | 4 passed (16)
   Start at  07:02:28
   Duration  501ms

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/integration/mcp-client.test.ts x5 

 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 281ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 15ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 15ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 35ms
     ‚Üí expected 406 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 13ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 7ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 5ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/index.spec.ts (6 tests | 3 failed) 166ms
   √ó Discogs MCP Server > should handle initialize request 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return server info for GET requests to main endpoint
   √ó Discogs MCP Server > should handle parse errors 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 13ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   ‚úì Discogs MCP Server > should return 404 for unknown paths
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Session ID extraction: { providedSessionId: 'mcp-efa543eedde602b1b37f96fe50283eb1' }
Looking up KV key: session:mcp-efa543eedde602b1b37f96fe50283eb1

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
No session found for key: session:mcp-efa543eedde602b1b37f96fe50283eb1

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 137 Text: event: message
data: {"jsonrpc":"2.0","id":2,"error":{"code":-32603,"message":"Authentication required to access collection resource"}}



stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 3681 Text: event: message
data: {"result":{"tools":[{"name":"ping","description":"Test connectivity to the Discogs MCP server","inputSchema":{"$schema":"http://json-schema.org/draft-07/schema#","type":"object","

 ‚ùØ test/integration/mcp-client.test.ts (3 tests | 1 failed) 196ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
   √ó MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 17ms
     ‚Üí expected [ { name: 'ping', ‚Ä¶(3) }, ‚Ä¶(7) ] to have a length of 2 but got 8

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 1 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
AssertionError: expected [ { name: 'ping', ‚Ä¶(3) }, ‚Ä¶(7) ] to have a length of 2 but got 8

- Expected
+ Received

- 2
+ 8

 ‚ùØ Proxy.methodWrapper Users/rian/Documents/GitHub/discogs-mcp/node_modules/.vite/vitest/deps_ssr/chai.js:1537:25
 ‚ùØ test/integration/mcp-client.test.ts:361:53
    359|    // Test tools
    360|    const toolsList = await client.listTools()
    361|    expect(toolsList.result.tools).toHaveLength(2) // public + authenti‚Ä¶
       |                                                     ^
    362| 
    363|    // Test resources

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/1]‚éØ


 Test Files  3 failed (3)
      Tests  11 failed | 5 passed (16)
   Start at  07:03:32
   Duration  664ms

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/integration/mcp-client.test.ts x6 

 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 281ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 15ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 15ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 35ms
     ‚Üí expected 406 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 13ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 7ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 5ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/index.spec.ts (6 tests | 3 failed) 166ms
   √ó Discogs MCP Server > should handle initialize request 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return server info for GET requests to main endpoint
   √ó Discogs MCP Server > should handle parse errors 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 13ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   ‚úì Discogs MCP Server > should return 404 for unknown paths
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should complete full initialization handshake
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Session ID extraction: { providedSessionId: 'mcp-efa543eedde602b1b37f96fe50283eb1' }
Looking up KV key: session:mcp-efa543eedde602b1b37f96fe50283eb1

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
No session found for key: session:mcp-efa543eedde602b1b37f96fe50283eb1

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should handle unauthenticated access to protected resources
Response status: 200 Text length: 137 Text: event: message
data: {"jsonrpc":"2.0","id":2,"error":{"code":-32603,"message":"Authentication required to access collection resource"}}



stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 270 Text: event: message
data: {"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{"listChanged":true},"resources":{"listChanged":true},"completions":{},"prompts":{"listChanged":true}},"serverInf

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

workerd/jsg/setup.c++:565: info: CODE_MOVED for unknown code block?
workerd/jsg/setup.c++:565: info: CODE_MOVED for unknown code block?
workerd/jsg/setup.c++:565: info: CODE_MOVED for unknown code block?
stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 224 Text: event: message
data: {"result":{"resources":[{"uri":"discogs://collection","name":"collection","mimeType":"application/json","description":"Complete Discogs collection for the authenticated user"}]},"

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Session ID extraction: { providedSessionId: 'mcp-efa543eedde602b1b37f96fe50283eb1' }

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Fetching fresh data for userProfiles:test-access-token
Making OAuth request to /oauth/identity with token: test-acces...

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Foauth%2Fidentity&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DKdtrpXZoyHqo3CwUyFyU3NUn50vkPZ4X%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765811033%26oauth_token%3Dtest-access-token%26oauth_version%3D1.0
OAuth signing key: test-secret&test-access-secret
OAuth signature: f88QfvUuZlBSOvaSbys3QSyjSXU=

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Fetching fresh data for collections:testuser:all:default:desc

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fper_page%3D100&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DEeiE9VClP3EROAivw67wWTy37FW5limD%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765811033%26oauth_token%3Dtest-access-token%26oauth_version%3D1.0
OAuth signing key: test-secret&test-access-secret
OAuth signature: YBt47HAA3IJ4DQqL7yF5xUukM5Y=

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 2115 Text: event: message
data: {"result":{"contents":[{"uri":"discogs://collection","mimeType":"application/json","text":"{\n  \"releases\": [\n    {\n      \"id\": 123456,\n      \"instance_id\": 123456,\n    

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 3681 Text: event: message
data: {"result":{"tools":[{"name":"ping","description":"Test connectivity to the Discogs MCP server","inputSchema":{"$schema":"http://json-schema.org/draft-07/schema#","type":"object","

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Session ID extraction: { providedSessionId: 'mcp-efa543eedde602b1b37f96fe50283eb1' }

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Fetching fresh data for userProfiles:test-access-token
Making OAuth request to /oauth/identity with token: test-acces...

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Foauth%2Fidentity&oauth_consumer_key%3Dtest-key%26oauth_nonce%3D0JlRTdDLv4hQE5msoMw9P3ke5FwRAQu2%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765811033%26oauth_token%3Dtest-access-token%26oauth_version%3D1.0
OAuth signing key: test-secret&test-access-secret
OAuth signature: m7d5GczlsuCpaBcIqOAebXQcf4k=

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Fetching fresh data for searches:testuser:Beatles:1

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
OAuth signature base string: GET&https%3A%2F%2Fapi.discogs.com%2Fusers%2Ftestuser%2Fcollection%2Ffolders%2F0%2Freleases%3Fpage%3D1%26per_page%3D100%26sort%3Dadded%26sort_order%3Ddesc&oauth_consumer_key%3Dtest-key%26oauth_nonce%3DRyEgpWfztZleQx3Zo0wGmUfsHdWdSGzR%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1765811033%26oauth_token%3Dtest-access-token%26oauth_version%3D1.0
OAuth signing key: test-secret&test-access-secret
OAuth signature: r9qhfKvOiv0Dk69Aj5AnltYkjdE=

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 372 Text: event: message
data: {"result":{"content":[{"type":"text","text":"Found 1 results for \"Beatles\" in your collection (showing 1 items):\n‚Ä¢ [ID: 123456] The Beatles - Abbey Road (1969)\n  Format: Vinyl

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/mcp-client.test.ts > MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features
Response status: 200 Text length: 421 Text: event: message
data: {"result":{"prompts":[{"name":"browse_collection","description":"Browse and explore your Discogs music collection","arguments":[]},{"name":"find_music","description":"Find specifi

 ‚úì test/integration/mcp-client.test.ts (3 tests) 494ms
   ‚úì MCP Client Integration Tests > Full MCP Protocol Flow > should allow authenticated access to all features 354ms

 Test Files  2 failed | 1 passed (3)
      Tests  10 failed | 6 passed (16)
   Start at  07:03:52
   Duration  1.08s

 PASS  Waiting for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/index.spec.ts x7 

 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 281ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 15ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 15ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 35ms
     ‚Üí expected 406 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 13ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 7ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 5ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/index.spec.ts > Discogs MCP Server > should handle initialize request
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/index.spec.ts > Discogs MCP Server > should handle empty body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/index.spec.ts (6 tests | 3 failed) 278ms
   √ó Discogs MCP Server > should handle initialize request 5ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return server info for GET requests to main endpoint
   √ó Discogs MCP Server > should handle parse errors 7ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 7ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   ‚úì Discogs MCP Server > should return 404 for unknown paths

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 3 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle initialize request
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/index.spec.ts:34:27
     32|   await waitOnExecutionContext(ctx)
     33| 
     34|   expect(response.status).toBe(200)
       |                           ^
     35|   expect(response.headers.get('content-type')).toBe('application/json')
     36| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/3]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle parse errors
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/index.spec.ts:89:11
     87|   await waitOnExecutionContext(ctx)
     88| 
     89|   expect(response.status).toBe(200) // JSON-RPC errors still return 200
       |           ^
     90|   const result = await response.json()
     91|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/3]‚éØ

 FAIL  test/index.spec.ts > Discogs MCP Server > should handle empty body
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/index.spec.ts:115:4
    113|   await waitOnExecutionContext(ctx)
    114| 
    115|   expect(response.status).toBe(200)
       |    ^
    116|   const result = await response.json()
    117|   expect(result).toMatchObject({

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/3]‚éØ


 Test Files  2 failed (2)
      Tests  10 failed | 3 passed (13)
   Start at  07:04:42
   Duration  640ms

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
c[3J RERUN  test/integration/logging-ratelimit.test.ts x8 

 ‚ùØ test/index.spec.ts (6 tests | 3 failed) 278ms
   √ó Discogs MCP Server > should handle initialize request 5ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return server info for GET requests to main endpoint
   √ó Discogs MCP Server > should handle parse errors 7ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Discogs MCP Server > should handle empty body 7ms
     ‚Üí expected 406 to be 200 // Object.is equality
   ‚úì Discogs MCP Server > should return 404 for unknown paths
   ‚úì Discogs MCP Server > should return 404 for unknown paths
[vpw:debug] Reusing runtime for vitest.config.mts...
stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

stdout | test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
[MCP] Session ID: mcp-efa543eedde602b1b37f96fe50283eb1 (source: deterministic)

 ‚ùØ test/integration/logging-ratelimit.test.ts (7 tests | 7 failed) 288ms
   √ó Logging and Rate Limiting Integration > should log successful MCP requests 31ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should log parse errors 4ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors 5ms
     ‚Üí expected 406 to be 429 // Object.is equality
   √ó Logging and Rate Limiting Integration > should skip rate limiting for initialize method 16ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully 10ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should handle empty request body 5ms
     ‚Üí expected 406 to be 200 // Object.is equality
   √ó Logging and Rate Limiting Integration > should measure request latency accurately 7ms
     ‚Üí undefined is not iterable (cannot read property Symbol(Symbol.iterator))

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 7 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log successful MCP requests
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:60:27
     58|   const response = await worker.fetch(request, mockEnv, {} as any)
     59| 
     60|   expect(response.status).toBe(200)
       |                           ^
     61| 
     62|   // Verify logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should log parse errors
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:89:27
     87|   const response = await worker.fetch(request, mockEnv, {} as any)
     88| 
     89|   expect(response.status).toBe(200)
       |                           ^
     90| 
     91|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should apply rate limiting and log rate limit errors
AssertionError: expected 406 to be 429 // Object.is equality

- Expected
+ Received

- 429
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:125:27
    123|   const response = await worker.fetch(request, mockEnv, {} as any)
    124| 
    125|   expect(response.status).toBe(429)
       |                           ^
    126|   expect(response.headers.get('Retry-After')).toBeDefined()
    127| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should skip rate limiting for initialize method
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:167:27
    165| 
    166|   // Should succeed despite rate limit
    167|   expect(response.status).toBe(200)
       |                           ^
    168| 
    169|   // Rate limiting should not have been checked for initialize

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle missing KV namespaces gracefully
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:207:27
    205| 
    206|   // Should still work without KV namespaces
    207|   expect(response.status).toBe(200)
       |                           ^
    208| 
    209|   // No KV operations should have been attempted

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should handle empty request body
AssertionError: expected 406 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 406

 ‚ùØ test/integration/logging-ratelimit.test.ts:223:27
    221|   const response = await worker.fetch(request, mockEnv, {} as any)
    222| 
    223|   expect(response.status).toBe(200)
       |                           ^
    224| 
    225|   // Verify error logging was called

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/7]‚éØ

 FAIL  test/integration/logging-ratelimit.test.ts > Logging and Rate Limiting Integration > should measure request latency accurately
TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
 ‚ùØ test/integration/logging-ratelimit.test.ts:262:24
    260|   const endTime = Date.now()
    261| 
    262|   const [, logValue] = mockMCP_LOGS.put.mock.calls[0]
       |                        ^
    263|   const logEntry = JSON.parse(logValue)
    264| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/7]‚éØ


 Test Files  2 failed (2)
      Tests  10 failed | 3 passed (13)
   Start at  07:04:44
   Duration  695ms

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
Test removed... [ test/index.spec.ts ]

Test removed... [ test/integration/logging-ratelimit.test.ts ]

